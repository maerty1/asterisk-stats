-- ==========================================
-- Оптимизация MariaDB для работы с большими данными
-- ==========================================
-- Только динамически изменяемые переменные (не read-only)

-- ==========================================
-- 1. Оптимизация JOIN операций
-- ==========================================

-- Увеличить размер буфера для JOIN
SET GLOBAL join_buffer_size = 8388608; -- 8MB

-- Оптимизация сортировки для больших результатов
SET GLOBAL sort_buffer_size = 8388608; -- 8MB

-- Размер буфера для чтения
SET GLOBAL read_buffer_size = 2097152; -- 2MB

-- Размер буфера для чтения случайных данных
SET GLOBAL read_rnd_buffer_size = 4194304; -- 4MB

-- ==========================================
-- 2. Оптимизация временных таблиц
-- ==========================================

-- Размер буфера для временных таблиц в памяти
SET GLOBAL tmp_table_size = 67108864; -- 64MB

-- Максимальный размер временной таблицы в памяти
SET GLOBAL max_heap_table_size = 67108864; -- 64MB

-- ==========================================
-- 3. Оптимизация для больших запросов
-- ==========================================

-- Максимальный размер пакета
SET GLOBAL max_allowed_packet = 67108864; -- 64MB

-- ==========================================
-- 4. Оптимизация для параллельных запросов
-- ==========================================

-- Кэш потоков (если еще не установлено)
-- SET GLOBAL thread_cache_size = 16;

-- Максимальные соединения (если еще не установлено)
-- SET GLOBAL max_connections = 200;

-- ==========================================
-- 5. Оптимизация для сортировки и группировки
-- ==========================================

-- Размер буфера для группировки
SET GLOBAL group_concat_max_len = 10240;

-- ==========================================
-- ПРИМЕЧАНИЕ: Read-only переменные
-- ==========================================
-- Следующие переменные являются read-only и требуют перезапуска MariaDB:
-- - innodb_buffer_pool_size
-- - innodb_buffer_pool_instances
-- - innodb_log_file_size
-- - innodb_log_buffer_size
--
-- Для их изменения добавьте в /etc/mysql/mariadb.conf.d/50-server.cnf:
--
-- [mariadb]
-- innodb_buffer_pool_size = 2G
-- innodb_buffer_pool_instances = 8
-- innodb_log_file_size = 256M
-- innodb_log_buffer_size = 16M
--
-- Затем перезапустите: systemctl restart mariadb

-- ==========================================
-- Проверка установленных значений
-- ==========================================
-- SHOW VARIABLES LIKE 'join_buffer_size';
-- SHOW VARIABLES LIKE 'sort_buffer_size';
-- SHOW VARIABLES LIKE 'tmp_table_size';
-- SHOW VARIABLES LIKE 'max_allowed_packet';
