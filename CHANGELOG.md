# История изменений

Все значимые изменения в этом проекте будут документироваться в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

## [1.1.0] - 2026-01-15

### Изменено
- **Рефакторинг**: Разбит `app.js` на модули (routes/settings.js, routes/email-reports.js, routes/rankings.js, routes/health.js)
- **Логирование**: Заменены все `console.log/error` на Winston logger в backend файлах
- **Очистка**: Удалены неиспользуемые зависимости (13 пакетов, экономия ~96MB)
- **Очистка**: Удалены неиспользуемые адаптеры БД (6 файлов)
- **Очистка**: Удалены дублирующиеся файлы sqlite-email-db.js
- **Структура**: SQL скрипты перемещены в папку `sql/`
- **Конфиг**: Исправлены deprecated опции mysql2

### Исправлено
- Исправлен TODO: добавлена фильтрация по очереди для всех методов получения входящих звонков
- Исправлена ошибка "too many placeholders" при больших выборках (batch processing)
- Исправлена формула расчета "Не обработано" в рейтинге

### Добавлено
- **Swagger API Docs**: Интерактивная документация `/api/docs/`
- **Prometheus метрики**: Endpoint `/api/metrics` с HTTP, DB, calls метриками
- **Health Check**: `/api/health`, `/api/health/live`, `/api/health/ready`
- **Docker**: Dockerfile, docker-compose.yml, .dockerignore
- **CI/CD**: GitHub Actions workflow (.github/workflows/ci.yml)
- **Сравнение периодов**: API `/api/comparison` для сравнения неделя к неделе, месяц к месяцу
- **i18n**: Многоязычность интерфейса (RU/EN) через `/api/i18n`
- **WebSocket**: Real-time обновления статистики через Socket.IO
- **Grafana дашборд**: JSON шаблон в `/grafana/asterisk-stats-dashboard.json`
- Cursor Rules для проекта (.cursor/rules/)
- Partials для EJS шаблонов (views/partials/)
- Фильтрация по рабочим часам (настраивается в модальном окне)
- Сохранение выбранных дат между страницами (sessionStorage)

### Безопасность
- Удалены уязвимые зависимости (sequelize с SQL injection)
- ⚠️ xlsx имеет известные уязвимости без патча (используется только для экспорта)

## [1.0.0] - 2025-12-24

### Добавлено
- Полная статистика по очередям Asterisk
- Отслеживание перезвонов (клиент и агент)
- Анализ входящих и исходящих звонков
- Dashboard с ключевыми метриками (Всего звонков, Процент ответа, Пропущенные, SLA)
- Дополнительные метрики (Перезвоны, Временные показатели)
- Почасовая статистика с интерактивным графиком
- Детальный лог звонков с пагинацией, поиском и сортировкой
- Воспроизведение записей разговоров
- Email-отчеты с настройкой получателей для каждой очереди
- Автоматическая ежедневная отправка отчетов
- Экспорт данных в CSV
- Material Design 3 интерфейс
- Адаптивный дизайн
- Быстрые фильтры (Сегодня, Вчера, Неделя, Месяц)
- Навигация между типами статистики (По очередям, Входящие, Исходящие)
- Модальное окно для настройки email-отчетов

### Технические детали
- Connection pooling для MySQL
- Batch processing для оптимизации запросов
- Gzip сжатие ответов
- Защита от SQL-инъекций
- Rate limiting
- Логирование с Winston

### Документация
- Полный README.md с инструкциями
- LICENSE (MIT)
- CONTRIBUTING.md
- Шаблоны для Issues
- .env.example с примерами конфигурации

[1.0.0]: https://github.com/maerty1/asterisk-stats/releases/tag/v1.0.0

